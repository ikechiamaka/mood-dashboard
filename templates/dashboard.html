{% extends 'base.html' %}
{% block title %}Healthcare Dashboard - Role-Based Access{% endblock %}

{% block content %}
<!-- Sidebar -->
<div class="sidebar" id="sidebarNav">
  <div class="sidebar-brand">
    <i class="fas fa-brain me-2"></i><span>NeuroSense</span>
  </div>
  <ul class="sidebar-nav">
    <li class="sidebar-item"><a href="#dashboardTop" class="sidebar-link active"><i
          class="fas fa-home"></i><span>Dashboard</span></a></li>
    <li class="sidebar-item"><a href="#healthMetrics" class="sidebar-link"><i class="fas fa-heartbeat"></i><span>Health
          Metrics</span></a></li>
    <li class="sidebar-item"><a href="#trendsSection" class="sidebar-link"><i
          class="fas fa-chart-line"></i><span>Trends</span></a></li>
    <li class="sidebar-item"><a href="#journalSection" class="sidebar-link"><i
          class="fas fa-book"></i><span>Journal</span></a></li>
    <li class="sidebar-item"><a href="#" class="sidebar-link" data-bs-toggle="modal" data-bs-target="#helpModal"><i
          class="fas fa-question-circle"></i><span>Help</span></a></li>
    <li id="adminNav" class="sidebar-item"><a href="/admin" class="sidebar-link"><i
          class="fas fa-tools"></i><span>Admin</span></a></li>
  </ul>
  <div class="p-3">
    <button id="syncWearable" class="btn btn-sm btn-light w-100 sidebar-action-btn" data-label="Sync Devices">
      <i class="fas fa-sync-alt me-2"></i>
      <span class="sidebar-action-text">Sync Devices Now</span>
    </button>
  </div>
  <div class="p-3 pt-0">
    <button id="addGoalBtn" type="button" class="btn btn-sm btn-primary w-100 sidebar-action-btn" data-bs-toggle="modal" data-bs-target="#goalModal" data-label="Add Goal">
      <i class="fas fa-plus me-2"></i>
      <span class="sidebar-action-text">Add Goal</span>
    </button>
  </div>
  <div class="p-3">
    <a class="btn btn-outline-light btn-sm w-100 sidebar-action-btn" href="/logout" data-label="Logout">
      <i class="fas fa-sign-out-alt me-2"></i>
      <span class="sidebar-action-text">Logout</span>
    </a>
  </div>
</div>
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- Main Content -->
<div class="main-content">
  <nav class="navbar navbar-expand-lg px-4" id="dashboardTop">
    <div class="navbar-main">
      <button class="btn btn-outline-primary d-lg-none navbar-icon-btn" type="button" id="sidebarToggle" aria-label="Toggle navigation" aria-controls="sidebarNav" aria-expanded="false">
        <i class="fas fa-bars"></i>
      </button>
      <a class="navbar-brand" href="#"><i class="fas fa-brain me-2"></i><span>NeuroSense Dashboard</span></a>
    </div>
    <div class="navbar-controls">
      <div class="navbar-controls-left">
        <div class="theme-toggle">
          <input class="theme-toggle-input" id="themeSwitch" type="checkbox" />
          <label class="theme-toggle-label" for="themeSwitch">
            <span class="theme-toggle-icon sun"><i class="fas fa-sun"></i></span>
            <span class="theme-toggle-icon moon"><i class="fas fa-moon"></i></span>
            <span class="theme-toggle-handle"></span>
            <span class="visually-hidden">Toggle dark mode</span>
          </label>
        </div>
        {% if show_role_switcher %}
        <div id="roleSwitcherContainer" class="dropdown">
          <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" id="roleDropdown"
            data-bs-toggle="dropdown">
            <i class="fas fa-user-shield me-1"></i> Switch Role
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item role-switcher-item" href="#" data-role="super_admin">Super Administrator</a></li>
            <li><a class="dropdown-item role-switcher-item" href="#" data-role="facility_admin">Facility Admin</a></li>
            <li><a class="dropdown-item role-switcher-item" href="#" data-role="staff">Staff Provider</a></li>
          </ul>
        </div>
        {% endif %}
      </div>
      <div class="navbar-controls-right">
        <div class="dropdown">
          <button class="btn btn-sm btn-primary dropdown-toggle d-flex align-items-center profile-btn" type="button"
            id="profileDropdown" data-bs-toggle="dropdown" data-label="Profile">
            <img id="currentUserAvatar" src="{{ url_for('static', filename='pic.jpg') }}" class="rounded-circle me-2"
              style="width:30px;height:30px;object-fit:cover;" />
            <span id="currentUserName">Blaine Cottrell</span>
          </button>
          <div class="dropdown-menu dropdown-menu-end">
            <a class="dropdown-item" id="profileViewLink" href="#"><i class="fas fa-user me-2"></i>Profile</a>
            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#settingsModal">Settings</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="/logout"><i class="fas fa-sign-out-alt me-2"></i>Logout</a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div class="container-fluid py-4">
    <section class="dashboard-hero card-custom mb-4">
      <div class="hero-intro">
        <div class="hero-meta">
          <span id="roleBadge" class="role-badge role-badge-gap role-badge-pending">Loading role...</span>
          <span class="divider" aria-hidden="true"></span>
          <span id="heroScopeText">Calibrating access scope...</span>
        </div>
        <h1>Care operations command center</h1>
        <p>Track live sensor feeds, surface patient narratives, and coordinate the next best action together with your team.</p>
        <div class="hero-actions">
          <div class="hero-select">
            <label class="visually-hidden" for="patientQuickSelect">Switch patient</label>
            <select id="patientQuickSelect" class="form-select hero-quick-select" aria-label="Switch patient">
              <option value="">Select a patient...</option>
            </select>
          </div>
          <button type="button" class="btn btn-primary" id="openCommandPaletteBtn">
            <i class="fas fa-magnifying-glass me-2"></i>Command palette
          </button>
          <button type="button" class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#goalModal">
            <i class="fas fa-plus me-2"></i>New care goal
          </button>
        </div>
      </div>
      <div class="hero-stats">
        <div class="hero-stat">
          <span class="label text-uppercase">Active patients</span>
          <span class="value" id="heroPatientCount">--</span>
          <span class="trend" id="heroPatientContext">Select a patient to view details</span>
        </div>
        <div class="hero-stat">
          <span class="label text-uppercase">Last sensor sync</span>
          <span class="value" id="heroLastUpdated">--</span>
          <span class="trend" id="heroVitalsContext">Sync devices to refresh vitals</span>
        </div>
        <div class="hero-stat">
          <span class="label text-uppercase">Predicted mood</span>
          <span class="value" id="heroMoodValue">--</span>
          <span class="trend" id="heroMoodContext">Awaiting model prediction</span>
        </div>
      </div>
    </section>

    <!-- Patient Hub -->
    <div class="card-custom patient-hub mb-4">
      <div class="patient-hub-header d-flex flex-wrap justify-content-between align-items-start gap-3">
        <div>
          <div class="card-title mb-1">Patients</div>
          <p class="text-muted small mb-0">Search, filter, and switch between patients assigned to you.</p>
        </div>
        <div class="patient-tools d-flex flex-wrap align-items-center justify-content-end gap-2 w-100 w-md-auto">
          <div class="patient-search position-relative flex-grow-1 flex-md-unset">
            <i class="fas fa-search"></i>
            <input id="patientSearchInput" type="text" class="form-control form-control-sm"
              placeholder="Search name, bed, condition..." autocomplete="off" aria-autocomplete="list"
              aria-expanded="false" aria-controls="patientSearchSuggestions" />
            <ul id="patientSearchSuggestions" class="patient-suggest list-unstyled d-none" role="listbox"></ul>
          </div>
          <div class="patient-group-toggle d-flex align-items-center gap-2">
            <label for="patientGroupMode" class="text-muted small mb-0">Group by</label>
            <select id="patientGroupMode" class="form-select form-select-sm patient-group-select">
              <option value="facility">Facility</option>
              <option value="risk">Risk Tier</option>
              <option value="none">None</option>
            </select>
          </div>
        </div>
      </div>
      <div class="patient-filters d-flex flex-wrap gap-2 mt-3" id="patientFilterChips" aria-label="Patient filters">
      </div>
      <div class="patient-hub-grid mt-3">
        <aside class="patient-hub-list-panel">
          <div class="patient-hub-list-header">
            <h6 class="text-uppercase text-muted small mb-0">Patients in view</h6>
            <span id="patientCountBadge" class="patient-list-count">--</span>
          </div>
          <div class="patient-list-wrapper">
            <div id="patientListEmpty" class="patient-list-empty text-muted text-center py-4 d-none">No patients available</div>
            <ul id="patientList" class="patient-list list-unstyled mb-0"></ul>
          </div>
        </aside>
        <section class="patient-current shadow-sm rounded-3" id="patientCurrentCard">
          <div class="d-flex align-items-center gap-3 flex-wrap">
            <img id="patientAvatar" src="{{ url_for('static', filename='pic.jpg') }}"
              data-default-src="{{ url_for('static', filename='pic.jpg') }}" class="rounded-circle patient-avatar"
              alt="Patient avatar" />
            <div class="patient-current-info flex-grow-1">
              <h5 id="patientName" class="mb-1">Select a patient</h5>
              <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
                <span id="patientAgeBadge" class="badge bg-info text-white">Age: --</span>
                <span id="patientIdBadge" class="badge bg-warning text-dark">ID: --</span>
                <span id="patientRiskBadge" class="badge bg-secondary text-white">Risk: --</span>
              </div>
              <div class="patient-bed text-muted small">
                <i class="fas fa-bed me-1"></i><span id="patientBedLabel">Pick a patient to load assignments.</span>
              </div>
            </div>
            <div class="patient-score-wrap text-end">
              <div class="text-muted small text-uppercase">Overall Score</div>
              <div id="patientOverallScore" class="badge bg-primary-subtle text-primary fw-semibold">--</div>
            </div>
          </div>
          <div class="patient-current-stats row row-cols-1 row-cols-md-3 g-3 mt-3">
            <div>
              <span class="label text-muted small text-uppercase">Primary Condition</span>
              <div id="patientCondition" class="fw-semibold">--</div>
            </div>
            <div>
              <span class="label text-muted small text-uppercase">Allergies</span>
              <div id="patientAllergy" class="fw-semibold">--</div>
            </div>
            <div>
              <span class="label text-muted small text-uppercase">Care Focus</span>
              <div id="patientCareFocus" class="fw-semibold">--</div>
            </div>
          </div>
          <div class="patient-current-health row row-cols-1 row-cols-md-3 g-3 mt-3">
            <div>
              <span class="label text-muted small text-uppercase">Movement Status</span>
              <div id="patientMovementStatus" class="fw-semibold">--</div>
            </div>
            <div>
              <span class="label text-muted small text-uppercase">Environment</span>
              <div id="patientEnvironmentStatus" class="fw-semibold">--</div>
            </div>
            <div>
              <span class="label text-muted small text-uppercase">Last Update</span>
              <div id="patientLatestUpdate" class="text-muted">--</div>
            </div>
          </div>
          <div class="patient-current-vitals mt-3 text-muted small">
            <i class="fas fa-heartbeat me-1"></i><span id="patientLatestVitals">--</span>
          </div>
          <div class="patient-current-actions mt-3 d-flex gap-2">
            <button id="patientOpenDrawer" type="button" class="btn btn-primary btn-sm">Open Detail Drawer</button>
          </div>
        </section>
      </div>
    </div>
    <div id="staffWarning" class="access-warning d-none">
      <i class="fas fa-exclamation-triangle me-2 text-danger"></i>
      <strong>Staff Access Restriction:</strong> You can only view data for patients assigned to you.
    </div>

    <div class="row g-4 dashboard-metrics-row">
      <div class="col-xl-4 col-md-6" id="healthMetrics">
        <div class="card-custom">
          <div class="card-title d-flex align-items-center justify-content-between">
            <span>Overall Health Score</span>
            <span class="badge bg-primary-subtle text-primary fw-semibold" id="patientOverallScoreCard">--</span>
          </div>
          <div class="chart-wrapper" aria-hidden="true">
            <canvas id="healthDonut"></canvas>
            <div id="healthDonutCenter" class="chart-center-text">--</div>
          </div>
          <div class="d-flex justify-content-between text-muted small mt-3">
            <span><i class="fas fa-arrow-up text-success me-1"></i><span id="healthTrendLabel">Live</span></span>
            <span id="healthStatusLabel">Optimal</span>
          </div>
        </div>
      </div>
      <div class="col-xl-4 col-md-6">
        <div class="card-custom stat-card">
          <div class="stat-icon"><i class="fas fa-thermometer-half"></i></div>
          <div class="stat-content">
            <div class="stat-title">Average Temperature</div>
            <p class="stat-value mb-0" id="avgTempValue">--</p>
          </div>
        </div>
      </div>
      <div class="col-xl-4 col-md-6">
        <div class="card-custom stat-card">
          <div class="stat-icon"><i class="fas fa-tint"></i></div>
          <div class="stat-content">
            <div class="stat-title">Average Humidity</div>
            <p class="stat-value mb-0" id="avgHumidityValue">--</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Health Status Overview -->
    <div class="row mt-2">
      <div class="col-xl-12 mb-4 fade-in delay-3">
        <div class="card-custom">
          <div class="card-title"><i class="fas fa-chart-pie"></i> Health Status Overview</div>
          <div class="row">
            <div class="col-md-4">
              <div class="text-center mb-4">
                <div class="mb-2"><i class="fas fa-brain fa-2x text-info"></i></div>
                <div class="h5 mb-1">Mental Health</div>
                <div id="mentalStatus" class="text-success">Stable</div>
                <div class="progress mt-2">
                  <div id="mentalProgress" class="progress-bar bg-info" role="progressbar" style="width: 75%"></div>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="text-center mb-4">
                <div class="mb-2"><i class="fas fa-heart fa-2x text-danger"></i></div>
                <div class="h5 mb-1">Physical Health</div>
                <div id="physicalStatus" class="text-warning">Moderate</div>
                <div class="progress mt-2">
                  <div id="physicalProgress" class="progress-bar bg-success" role="progressbar" style="width: 65%">
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="text-center mb-4">
                <div class="mb-2"><i class="fas fa-walking fa-2x text-primary"></i></div>
                <div class="h5 mb-1">Activity Level</div>
                <div id="activityStatus" class="text-success">Active</div>
                <div class="progress mt-2">
                  <div id="activityProgress" class="progress-bar bg-warning" role="progressbar" style="width: 85%">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Anchor for Trends section (moved under User Management) -->

    <div class="row">
      <!-- Facility Management (moved from sidebar) -->
      <div id="facilityMgmt" class="col-12 mb-4 d-none">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h5 class="mb-0"><i class="fas fa-hospital me-2"></i>Facility Management</h5>
          <span class="text-muted small">Admins only</span>
        </div>
        <div class="row">
          <div class="col-xl-4 mb-4">
            <div class="card-custom">
              <div class="card-title">Beds</div>
              <form class="row g-2 mb-3">
                <div class="col-5"><input id="bedName" class="form-control form-control-sm" placeholder="Bed name" />
                </div>
                <div class="col-3"><input id="bedRoom" class="form-control form-control-sm" placeholder="Room" /></div>
                <div class="col-4"><input id="bedPatient" class="form-control form-control-sm"
                    placeholder="Patient (opt)" /></div>
                <div class="col-12 text-end"><button id="addBedBtn" type="button" class="btn btn-sm btn-primary">Add Bed</button>
                </div>
              </form>
              <ul id="bedsList" class="list-group list-group-flush small"></ul>
            </div>
          </div>
          <div class="col-xl-4 mb-4">
            <div class="card-custom">
              <div class="card-title">Staff Contacts</div>
              <form class="row g-2 mb-3">
                <div class="col-6"><input id="staffName" class="form-control form-control-sm" placeholder="Name" />
                </div>
                <div class="col-6"><input id="staffPhone" class="form-control form-control-sm" placeholder="+1..." />
                </div>
                <div class="col-12 text-end"><button id="addStaffBtn" type="button" class="btn btn-sm btn-primary">Add Staff</button>
                </div>
              </form>
              <ul id="staffList" class="list-group list-group-flush small"></ul>
            </div>
          </div>
          <div class="col-xl-4 mb-4">
            <div class="card-custom">
              <div class="card-title">Shifts</div>
              <form class="row g-2 mb-3">
                <div class="col-6"><input id="shiftName" class="form-control form-control-sm"
                    placeholder="Shift name" /></div>
                <div class="col-3"><input id="shiftStart" class="form-control form-control-sm"
                    placeholder="Start HH:MM" /></div>
                <div class="col-3"><input id="shiftEnd" class="form-control form-control-sm" placeholder="End HH:MM" />
                </div>
                <div class="col-8"><input id="shiftDays" class="form-control form-control-sm"
                    placeholder="Days e.g. 0,1,2" /></div>
                <div class="col-4"><input id="shiftStaffIds" class="form-control form-control-sm"
                    placeholder="Staff IDs" /></div>
                <div class="col-12 text-end"><button id="addShiftBtn" type="button" class="btn btn-sm btn-primary">Add Shift</button>
                </div>
              </form>
              <ul id="shiftsList" class="list-group list-group-flush small"></ul>
            </div>
          </div>
        </div>
      </div>

      <!-- User Management -->
      <div id="userMgmt" class="col-12 mb-4 d-none">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h5 class="mb-0"><i class="fas fa-users-cog me-2"></i>User Management</h5>
          <span class="text-muted small">Admins only</span>
        </div>
        <div class="card-custom">
          <div class="card-title">Add User</div>
          <form class="row g-2 mb-3">
            <div class="col-xl-3 col-md-6"><input id="userEmail" class="form-control form-control-sm"
                placeholder="Email" /></div>
            <div class="col-xl-2 col-md-6"><input id="userName" class="form-control form-control-sm"
                placeholder="Name (opt)" /></div>
            <div class="col-xl-2 col-md-6"><input id="userPassword" type="password" class="form-control form-control-sm"
                placeholder="Password" /></div>
            <div class="col-xl-2 col-md-6">
              <select id="userRole" class="form-select form-select-sm">
                <option value="staff">Staff</option>
                <option value="facility_admin">Facility Admin</option>
                <option value="super_admin">Super Admin</option>
              </select>
            </div>
            <div class="col-xl-1 col-md-6"><input id="userFacilityId" class="form-control form-control-sm"
                placeholder="Facility" /></div>
            <div class="col-xl-2 col-md-6"><input id="userAssigned" class="form-control form-control-sm"
                placeholder="Assigned IDs (1,2)" /></div>
            <div class="col-12 text-end"><button id="addUserBtn" type="button" class="btn btn-sm btn-primary">Add User</button></div>
          </form>
          <ul id="usersList" class="list-group list-group-flush small"></ul>
        </div>
      </div>

      <!-- Trends Header under User Management -->
      <div id="trendsSection" class="mb-2"></div>
      <div class="row align-items-center mt-4 mb-2">
        <div class="col-12 d-flex align-items-center justify-content-between">
          <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Trends</h5>
          <span class="text-muted small">Last 7 days</span>
        </div>
      </div>
      <div id="trendsEmpty" class="text-muted small mb-3">Select a patient to view trend analytics.</div>

      <div class="col-xl-6 mb-4">
        <div class="card-custom">
          <div class="card-title">Mood Trend</div>
          <div class="trend-chart"><canvas id="moodChart"></canvas></div>
        </div>
      </div>
      <div class="col-xl-6 mb-4">
        <div class="card-custom">
          <div class="card-title">Activity Trend</div>
          <div class="trend-chart"><canvas id="moveChart"></canvas></div>
        </div>
      </div>
    </div>

    <!-- Check-Ins Section -->
    <div id="checkinsSection" class="row mt-2">
      <div class="col-xl-4 col-lg-5 mb-4">
        <div class="card-custom h-100">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="card-title mb-0">Record a Mood Check-In</div>
            <span class="badge bg-light text-dark text-uppercase small fw-semibold">Daily</span>
          </div>
          <p class="text-muted small mb-3">Capture how the patient feels right now. Mood ratings use the 1-6 scale from the prediction model.</p>
          <form id="checkinForm" class="row g-2">
            <div class="col-12">
              <label class="form-label small text-muted text-uppercase">Mood</label>
              <select id="checkinMood" class="form-select form-select-sm" required>
                <option value="">Select mood</option>
                <option value="1">1 - Very Low</option>
                <option value="2">2 - Low</option>
                <option value="3">3 - Neutral</option>
                <option value="4">4 - Fair</option>
                <option value="5">5 - Good</option>
                <option value="6">6 - Excellent</option>
              </select>
            </div>
            <div class="col-12">
              <label class="form-label small text-muted text-uppercase">Stress Level</label>
              <select id="checkinStress" class="form-select form-select-sm">
                <option value="">Not captured</option>
                <option value="low">Low</option>
                <option value="moderate">Moderate</option>
                <option value="high">High</option>
              </select>
            </div>
            <div class="col-12">
              <label class="form-label small text-muted text-uppercase">Notes (optional)</label>
              <textarea id="checkinNotes" rows="3" class="form-control form-control-sm" placeholder="Add short observations..."></textarea>
            </div>
            <div class="col-12 text-end">
              <button type="submit" class="btn btn-primary btn-sm">
                <i class="fas fa-save me-2"></i>Save Check-In
              </button>
            </div>
          </form>
        </div>
      </div>
      <div class="col-xl-8 col-lg-7 mb-4">
        <div class="card-custom h-100">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div class="card-title mb-0">Recent Check-Ins</div>
            <button id="refreshCheckinsBtn" type="button" class="btn btn-link btn-sm text-decoration-none">
              <i class="fas fa-rotate me-1"></i>Refresh
            </button>
          </div>
          <div id="checkinsEmpty" class="text-muted small py-4 text-center">No check-ins recorded yet.</div>
          <ul id="checkinsList" class="list-group list-group-flush small"></ul>
        </div>
      </div>
    </div>

    <!-- Care Goals Section -->
    <div id="goalsSection" class="row mt-2">
      <div class="col-xl-6 col-lg-7 mb-4">
        <div class="card-custom h-100">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="card-title mb-0">Care Goals</div>
            <button id="addGoalFromCard" type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#goalModal">
              <i class="fas fa-plus me-2"></i>New Goal
            </button>
          </div>
          <p class="text-muted small mb-3">Track short-term objectives for the selected patient.</p>
          <div id="goalsEmpty" class="text-muted small py-4 text-center">No goals created yet.</div>
          <ul id="goalsList" class="list-group list-group-flush small"></ul>
        </div>
      </div>
    </div>

    <!-- Journal Section -->
    <div id="journalSection" class="row mt-2">
      <div class="col-xl-6 mb-4">
        <div class="card-custom">
          <div class="card-title">Add Journal Entry</div>
          <form class="row g-2 mb-3">
            <div class="col-12"><textarea id="journalText" rows="3" class="form-control"
                placeholder="How are you feeling?"></textarea></div>
            <div class="col-6">
              <select id="journalMood" class="form-select form-select-sm">
                <option value="1">Sad</option>
                <option value="2">Low</option>
                <option value="3" selected>Neutral</option>
                <option value="4">Fair</option>
                <option value="5">Good</option>
                <option value="6">Happy</option>
              </select>
            </div>
            <div class="col-6 text-end"><button id="addJournalBtn" type="button" class="btn btn-sm btn-primary">Add Entry</button>
            </div>
          </form>
        </div>
      </div>
      <div class="col-xl-6 mb-4">
        <div class="card-custom">
          <div class="card-title">Recent Journal Entries</div>
          <ul id="journalList" class="list-group list-group-flush small"></ul>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-xl-4 mb-4">
        <div class="sensor-status">
          <div class="sensor-icon"><i class="fas fa-wind"></i></div>
          <div class="sensor-text">Air Quality</div>
          <div class="badge-indicator bg-success text-white" id="airQualityBadge">Good</div>
          <div class="sensor-time mt-2" id="lastUpdatedText">Updated just now</div>
        </div>
      </div>
      <div class="col-xl-8 mb-4">
        <div class="insight-card">
          <div class="insight-text" id="weeklyInsights">
            Weekly insights will appear here.
          </div>
        </div>
      </div>
    </div>

  </div>
</div>


<div id="patientDetailDrawer" class="patient-drawer" aria-hidden="true">
  <div class="patient-drawer-overlay" id="patientDrawerOverlay"></div>
  <aside class="patient-drawer-panel" role="dialog" aria-labelledby="patientDrawerTitle">
    <div class="patient-drawer-header">
      <div>
        <h5 id="patientDrawerTitle" class="mb-1">Patient Summary</h5>
        <p id="patientDrawerSubtitle" class="text-muted small mb-0">Select a patient to open their detail drawer.</p>
      </div>
      <button type="button" class="btn btn-sm btn-outline-secondary" id="patientDrawerClose" data-drawer-focus>
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="patient-drawer-body">
      <div class="patient-drawer-identity d-flex align-items-center gap-3 mb-3">
        <img id="patientDrawerAvatar" src="{{ url_for('static', filename='pic.jpg') }}"
          data-default-src="{{ url_for('static', filename='pic.jpg') }}" class="rounded-circle" alt="Patient avatar" />
        <div>
          <h4 id="patientDrawerName" class="mb-1">No patient selected</h4>
          <div id="patientDrawerMeta" class="text-muted small">Choose a patient to see context and recent activity.
          </div>
          <div class="drawer-badges d-flex flex-wrap gap-2 mt-2">
            <span class="badge patient-risk-badge risk-unknown" id="patientDrawerRisk">Risk: --</span>
            <span class="badge bg-light text-muted" id="patientDrawerFacility">Facility --</span>
          </div>
        </div>
      </div>
      <div class="patient-drawer-section">
        <h6>Care Overview</h6>
        <dl class="drawer-def-list">
          <div>
            <dt>Primary Condition</dt>
            <dd id="patientDrawerCondition">--</dd>
          </div>
          <div>
            <dt>Care Focus</dt>
            <dd id="patientDrawerCareFocus">--</dd>
          </div>
          <div>
            <dt>Allergies</dt>
            <dd id="patientDrawerAllergies">--</dd>
          </div>
        </dl>
      </div>
      <div class="patient-drawer-section">
        <h6>Latest Signals</h6>
        <ul class="drawer-metrics list-unstyled mb-0">
          <li><span>Overall Score</span><strong id="patientDrawerOverall">--</strong></li>
          <li><span>Movement</span><strong id="patientDrawerMovement">--</strong></li>
          <li><span>Environment</span><strong id="patientDrawerEnvironment">--</strong></li>
          <li><span>Predicted Mood</span><strong id="patientDrawerMood">--</strong></li>
          <li><span>Vitals</span><strong id="patientDrawerVitals">--</strong></li>
          <li><span>Last Update</span><strong id="patientDrawerLastUpdate">--</strong></li>
        </ul>
      </div>
      <div class="patient-drawer-section">
        <h6>Journal Highlight</h6>
        <p id="patientDrawerNotes" class="text-muted small mb-0">Add a journal entry to capture observations or
          interventions.</p>
      </div>
    </div>
  </aside>
</div>

<div id="commandPalette" class="command-palette" aria-hidden="true">
  <div class="command-palette-backdrop"></div>
  <div class="command-palette-panel" role="dialog" aria-modal="true" aria-label="Command palette">
    <div class="command-palette-input-wrap">
      <i class="fas fa-search"></i>
      <input id="commandPaletteInput" type="text" class="form-control" placeholder="Jump to patient or action..."
        autocomplete="off" aria-expanded="false" aria-controls="commandPaletteList" />
      <span class="command-palette-hint">ESC</span>
    </div>
    <ul id="commandPaletteList" class="command-palette-results list-unstyled" role="listbox"></ul>
    <div class="command-palette-footer text-muted small d-flex justify-content-between">
      <span><kbd>Up</kbd><kbd>Down</kbd> navigate</span>
      <span><kbd>Enter</kbd> select</span>
      <span><kbd>Esc</kbd> close</span>
    </div>
  </div>
</div>

<!-- Profile Modal -->
<div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">My Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="d-flex align-items-center gap-3 mb-3">
          <img id="profileAvatar" src="{{ url_for('static', filename='pic.jpg') }}"
            data-default-src="{{ url_for('static', filename='pic.jpg') }}" class="profile-modal-avatar rounded-circle"
            alt="Profile avatar" />
          <div>
            <h5 id="profileName" class="mb-1">--</h5>
            <div id="profileEmail" class="text-muted small">--</div>
          </div>
        </div>
        <dl class="row profile-modal-details mb-0">
          <dt class="col-4 text-muted small text-uppercase">Role</dt>
          <dd class="col-8" id="profileRole">--</dd>
          <dt class="col-4 text-muted small text-uppercase">Facility</dt>
          <dd class="col-8" id="profileFacility">--</dd>
        </dl>
        <div class="mt-3">
          <div class="text-muted small text-uppercase mb-1">Assigned Patients</div>
          <div id="profileAssigned" class="profile-assigned-list">--</div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- Settings Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Settings</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <label class="form-label">Theme</label>
        <select id="themeSelect" class="form-select mb-3">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
        <label class="form-label">Upload Avatar</label>
        <input id="avatarUpload" type="file" accept="image/*" class="form-control mb-3" />
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary">Save Changes</button>
      </div>
    </div>
  </div>
</div>

<!-- Goal Modal -->
<div class="modal fade" id="goalModal" tabindex="-1" aria-labelledby="goalModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="goalModalLabel">Add Care Goal</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="goalForm">
        <div class="modal-body">
          <div class="mb-3">
            <label for="goalTitle" class="form-label">Goal title</label>
            <input id="goalTitle" name="title" type="text" class="form-control" placeholder="Example: Evening walk with staff" required>
          </div>
          <div class="mb-3">
            <label for="goalDueDate" class="form-label">Target date (optional)</label>
            <input id="goalDueDate" name="due_date" type="date" class="form-control">
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="1" id="goalNotify">
            <label class="form-check-label" for="goalNotify">
              Send me an alert when this goal is due
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Goal</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Help</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>Use the sidebar to navigate between Dashboard, Health Metrics, Trends, and Journal. Admins can manage
          facility resources and users.</p>
        <ul>
          <li>Health Metrics: overall health score and key averages</li>
          <li>Trends: mood and activity charts</li>
          <li>Journal: add entries and review recent notes</li>
          <li>Settings: change theme and update your avatar</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" data-bs-dismiss="modal">Got it</button>
      </div>
    </div>
  </div>
</div>

<div class="toast-container position-fixed top-0 end-0 p-3" id="toastContainer" aria-live="polite" aria-atomic="true"></div>
{% endblock %}










